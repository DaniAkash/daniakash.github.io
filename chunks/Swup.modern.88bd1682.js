const C=new WeakMap;function $(t,e,n,i){var s,r;if(!t&&!C.has(e))return!1;const a=(s=C.get(e))!==null&&s!==void 0?s:new WeakMap;if(C.set(e,a),!t&&!C.has(e))return!1;const o=(r=a.get(n))!==null&&r!==void 0?r:new Set;a.set(n,o);const l=o.has(i);return t?o.add(i):o.delete(i),l&&t}function V(t){return typeof t.addEventListener=="function"}function F(t,e){let n=t.target;if(n instanceof Text&&(n=n.parentElement),n instanceof Element&&t.currentTarget instanceof Element){const i=n.closest(e);if(i&&t.currentTarget.contains(i))return i}}function I(t,e,n,i,s){if(typeof t=="string"&&(t=document.querySelectorAll(t)),!V(t)){const u=Array.prototype.map.call(t,c=>I(c,e,n,i,s));return{destroy(){for(const c of u)c.destroy()}}}const r=t instanceof Document?t.documentElement:t,a=Boolean(typeof s=="object"?s.capture:s),o=u=>{const c=F(u,e);c&&(u.delegateTarget=c,i.call(r,u))};typeof s=="object"&&delete s.once;const l=JSON.stringify({selector:e,type:n,capture:a}),g=$(!0,r,i,l),h={destroy(){r.removeEventListener(n,o,s),$(!1,r,i,l)}};return g||r.addEventListener(n,o,s),h}function p(){return p=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},p.apply(this,arguments)}const B=(t,e)=>String(t).toLowerCase().replace(/[\s/_.]+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+|-+$/g,"")||e||"",d=({hash:t}={})=>location.pathname+location.search+(t?location.hash:""),K=(t,e={})=>{const n=p({url:t=t||d({hash:!0}),random:Math.random(),source:"swup"},e);history.pushState(n,"",t)},R=(t=null,e={})=>{t=t||d({hash:!0});const n=p({},history.state,{url:t,random:Math.random(),source:"swup"},e);history.replaceState(n,"",t)},X=["base"],x=(t,e,n,i={})=>{let{base:s=document}=i,r=function(o,l){if(o==null)return{};var g,h,u={},c=Object.keys(o);for(h=0;h<c.length;h++)l.indexOf(g=c[h])>=0||(u[g]=o[g]);return u}(i,X);const a=I(s,t,e,n,r);return{destroy:()=>a.destroy()}},w=(t,e=document)=>e.querySelector(t),m=(t,e=document)=>Array.from(e.querySelectorAll(t)),G=t=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{t()})})},J=t=>window.CSS&&window.CSS.escape?CSS.escape(t):t,M=t=>1e3*Number(t.slice(0,-1).replace(",",".")),z=(t,e)=>{var n,i;let s=document.createElement("html");s.innerHTML=t;let r=[];e.forEach(l=>{if(w(l,s)==null)return console.warn(`[swup] Container ${l} not found on page.`),null;m(l).length!==m(l,s).length&&console.warn("[swup] Mismatched number of containers found on new page."),m(l).forEach((g,h)=>{m(l,s)[h].setAttribute("data-swup",String(r.length)),r.push(m(l,s)[h].outerHTML)})});const a=((n=w("title",s))==null?void 0:n.innerText)||"",o=(i=w("body",s))==null?void 0:i.className;return s.innerHTML="",s=null,{title:a,pageClass:o,blocks:r,originalContent:t}},Q=(t,e)=>{const n={url:window.location.pathname+window.location.search,method:"GET",data:null,headers:{}},{url:i,method:s,headers:r,data:a}=p({},n,t),o=new XMLHttpRequest;return o.onreadystatechange=function(){o.readyState===4&&e(o)},o.open(s,i,!0),Object.entries(r).forEach(([l,g])=>{o.setRequestHeader(l,g)}),o.send(a),o};class f extends URL{constructor(e,n=document.baseURI){super(e.toString(),n)}get url(){return this.pathname+this.search}static fromElement(e){const n=e.getAttribute("href")||e.getAttribute("xlink:href");return new f(n)}static fromUrl(e){return new f(e)}}const Y=(t,e)=>{let n=0;e.forEach(i=>{w(i,t)==null?console.warn(`[swup] Container ${i} not found on page.`):m(i).forEach((s,r)=>{m(i,t)[r].setAttribute("data-swup",String(n)),n++})})},Z=t=>/^to-/.test(t)||["is-changing","is-rendering","is-popstate"].includes(t),O=()=>{const t=document.documentElement.className.split(" ").filter(Z);document.documentElement.classList.remove(...t)};class ee{constructor(e){this.pages={},this.last=null,this.swup=void 0,this.swup=e}getCacheUrl(e){return this.swup.resolveUrl(f.fromUrl(e).url)}cacheUrl(e){e.url=this.getCacheUrl(e.url),e.url in this.pages==0&&(this.pages[e.url]=e),e.responseURL=this.getCacheUrl(e.responseURL),this.last=this.pages[e.url],this.swup.log(`Cache (${Object.keys(this.pages).length})`,this.pages)}getPage(e){return e=this.getCacheUrl(e),this.pages[e]}getCurrentPage(){return this.getPage(d())}exists(e){return(e=this.getCacheUrl(e))in this.pages}empty(){this.pages={},this.last=null,this.swup.log("Cache cleared")}remove(e){delete this.pages[this.getCacheUrl(e)]}}const te=function({event:t,skipTransition:e}={}){if(e)return this.triggerEvent("transitionEnd",t),this.cleanupAnimationClasses(),[Promise.resolve()];G(()=>{this.triggerEvent("animationInStart"),document.documentElement.classList.remove("is-animating")});const n=this.getAnimationPromises("in");return Promise.all(n).then(()=>{this.triggerEvent("animationInDone"),this.triggerEvent("transitionEnd",t),this.cleanupAnimationClasses()}),n},q=t=>t?(t.charAt(0)==="#"&&(t=t.substring(1)),t=decodeURIComponent(t),t=J(t),w(`#${t}`)||w(`a[name='${t}']`)):null;let A="transition",N="transitionend",_="animation",W="animationend";function ne(t){const e=this.options.animationSelector;if(e===!1)return[Promise.resolve()];const n=m(e,document.body);return n.length?n.map(i=>function(s,r,a=null){const{type:o,timeout:l,propCount:g}=function(h,u=null){const c=window.getComputedStyle(h),y=`${A}Duration`,b=`${_}Delay`,U=`${_}Duration`,E=c[`${A}Delay`].split(", "),P=(c[y]||"").split(", "),k=D(E,P),j=(c[b]||"").split(", "),H=(c[U]||"").split(", "),L=D(j,H);let v="",S=0,T=0;return u==="transition"?k>0&&(v="transition",S=k,T=P.length):u==="animation"?L>0&&(v="animation",S=L,T=H.length):(S=Math.max(k,L),v=S>0?k>L?"transition":"animation":null,T=v?v==="transition"?P.length:H.length:0),{type:v,timeout:S,propCount:T}}(s,a);return o&&l?new Promise(h=>{const u=o==="transition"?N:W,c=performance.now();let y=0;const b=()=>{s.removeEventListener(u,U),h()},U=E=>{if(E.target===s){if(!(P=>!!P.elapsedTime)(E))throw new Error("Not a transition or animation event.");(performance.now()-c)/1e3<E.elapsedTime||++y>=g&&b()}};setTimeout(()=>{y<g&&b()},l+1),s.addEventListener(u,U)}):(console.warn(`[swup] No CSS transition duration defined for element of selector ${r}`),Promise.resolve())}(i,e)):(console.warn(`[swup] No animated elements found by selector ${e}`),[Promise.resolve()])}function D(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max(...e.map((n,i)=>M(n)+M(t[i])))}window.ontransitionend===void 0&&window.onwebkittransitionend!==void 0&&(A="WebkitTransition",N="webkitTransitionEnd"),window.onanimationend===void 0&&window.onwebkitanimationend!==void 0&&(_="WebkitAnimation",W="webkitAnimationEnd");const ie=function(t){const e=z(t.responseText,this.options.containers);return e?p({},e,{responseURL:t.responseURL||window.location.href}):(console.warn("[swup] Received page is invalid."),null)};function se(t){const e=this.options.requestHeaders,{url:n}=t;return this.cache.exists(n)?(this.triggerEvent("pageRetrievedFromCache"),Promise.resolve(this.cache.getPage(n))):new Promise((i,s)=>{Q(p({},t,{headers:e}),r=>{if(r.status===500)return this.triggerEvent("serverError"),void s(n);const a=this.getPageData(r);if(!a||!a.blocks.length)return void s(n);const o=p({},a,{url:n});this.cache.cacheUrl(o),this.triggerEvent("pageLoaded"),i(o)})})}const re=function({event:t,skipTransition:e}={}){const n=t instanceof PopStateEvent;if(e)return this.triggerEvent("animationSkipped"),[Promise.resolve()];this.triggerEvent("animationOutStart"),document.documentElement.classList.add("is-changing","is-leaving","is-animating"),n&&document.documentElement.classList.add("is-popstate");const i=this.getAnimationPromises("out");return Promise.all(i).then(()=>{this.triggerEvent("animationOutDone")}),i};function oe(t){const{url:e}=t;this.shouldIgnoreVisit(e)?window.location.href=e:this.performPageLoad(t)}function ae(t){const{url:e,event:n,customTransition:i}=t??{},s=n instanceof PopStateEvent,r=this.shouldSkipTransition({url:e,event:n});this.triggerEvent("transitionStart",n),this.updateTransition(d(),e,i),i!=null&&document.documentElement.classList.add(`to-${B(i)}`);const a=this.leavePage({event:n,skipTransition:r});s||K(e+(this.scrollToElement||"")),this.currentPageUrl=d();const o=this.fetchPage(t);Promise.all([o,...a]).then(([l])=>{this.renderPage(l,{event:n,skipTransition:r})}).catch(l=>{l!==void 0&&(this.options.skipPopStateHandling=()=>(window.location=l,!0),history.go(-1))})}const le=function({blocks:t,title:e}){return t.forEach((n,i)=>{document.body.querySelector(`[data-swup="${i}"]`).outerHTML=n}),document.title=e,Promise.resolve()};function ce(t,e){this._handlers[t]?this._handlers[t].push(e):console.warn(`Unsupported event ${t}.`)}function ue(t,e){t&&e?this._handlers[t].includes(e)?this._handlers[t]=this._handlers[t].filter(n=>n!==e):console.warn(`Handler for event '${t}' not found.`):t?this._handlers[t]=[]:Object.keys(this._handlers).forEach(n=>{this._handlers[n]=[]})}function he(t,e){this._handlers[t].forEach(i=>{try{i(e)}catch(s){console.error(s)}});const n=new CustomEvent(`swup:${t}`,{detail:t});document.dispatchEvent(n)}const de=function(t){var e;if((e=t)!=null&&e.isSwupPlugin){if(t.swup=this,!t._checkRequirements||t._checkRequirements())return t._beforeMount&&t._beforeMount(),t.mount(),this.plugins.push(t),this.plugins}else console.error("Not a swup plugin instance",t)};function ge(t){const e=this.findPlugin(t);if(e)return e.unmount(),e._afterUnmount&&e._afterUnmount(),this.plugins=this.plugins.filter(n=>n!==e),this.plugins;console.error("No such plugin",e)}function pe(t){return this.plugins.find(e=>e===t||e.name===t)}const me=function(t,{event:e,skipTransition:n}={}){if(document.documentElement.classList.remove("is-leaving"),!this.isSameResolvedUrl(d(),t.url))return;const{url:i}=f.fromUrl(t.responseURL);this.isSameResolvedUrl(d(),i)||(this.cache.cacheUrl(p({},t,{url:i})),this.currentPageUrl=d(),R(i)),n||document.documentElement.classList.add("is-rendering"),this.triggerEvent("willReplaceContent",e),this.replaceContent(t).then(()=>{this.triggerEvent("contentReplaced",e),this.triggerEvent("pageView",e),this.options.cache||this.cache.empty(),this.enterPage({event:e,skipTransition:n}),this.scrollToElement=null})};function fe(t,e,n){this.transition={from:t,to:e,custom:n}}function ve({event:t}){return!(!(t instanceof PopStateEvent)||this.options.animateHistoryBrowsing)}class we{constructor(e={}){this.version="3.0.2",this._handlers={animationInDone:[],animationInStart:[],animationOutDone:[],animationOutStart:[],animationSkipped:[],clickLink:[],contentReplaced:[],disabled:[],enabled:[],openPageInNewTab:[],pageLoaded:[],pageRetrievedFromCache:[],pageView:[],popState:[],samePage:[],samePageWithHash:[],serverError:[],transitionStart:[],transitionEnd:[],willReplaceContent:[]},this.scrollToElement=null,this.options=void 0,this.plugins=[],this.transition={},this.cache=void 0,this.currentPageUrl=d(),this.delegatedListeners={},this.boundPopStateHandler=void 0,this.loadPage=oe,this.performPageLoad=ae,this.leavePage=re,this.renderPage=me,this.replaceContent=le,this.enterPage=te,this.triggerEvent=he,this.delegateEvent=x,this.on=ce,this.off=ue,this.updateTransition=fe,this.shouldSkipTransition=ve,this.getAnimationPromises=ne,this.getPageData=ie,this.fetchPage=se,this.getAnchorElement=q,this.log=()=>{},this.use=de,this.unuse=ge,this.findPlugin=pe,this.getCurrentUrl=d,this.cleanupAnimationClasses=O,this.defaults={animateHistoryBrowsing:!1,animationSelector:'[class*="transition-"]',cache:!0,containers:["#swup"],ignoreVisit:(n,{el:i}={})=>!(i==null||!i.closest("[data-no-swup]")),linkSelector:"a[href]",plugins:[],resolveUrl:n=>n,requestHeaders:{"X-Requested-With":"swup",Accept:"text/html, application/xhtml+xml"},skipPopStateHandling:n=>{var i;return((i=n.state)==null?void 0:i.source)!=="swup"}},this.options=p({},this.defaults,e),this.boundPopStateHandler=this.popStateHandler.bind(this),this.cache=new ee(this),this.enable()}enable(){typeof Promise<"u"?(this.delegatedListeners.click=x(this.options.linkSelector,"click",this.linkClickHandler.bind(this)),window.addEventListener("popstate",this.boundPopStateHandler),Y(document.documentElement,this.options.containers),this.options.plugins.forEach(e=>this.use(e)),R(),this.triggerEvent("enabled"),document.documentElement.classList.add("swup-enabled"),this.triggerEvent("pageView")):console.warn("Promise is not supported")}destroy(){this.delegatedListeners.click.destroy(),window.removeEventListener("popstate",this.boundPopStateHandler),this.cache.empty(),this.options.plugins.forEach(e=>{this.unuse(e)}),m("[data-swup]").forEach(e=>{e.removeAttribute("data-swup")}),this.off(),this.triggerEvent("disabled"),document.documentElement.classList.remove("swup-enabled")}shouldIgnoreVisit(e,{el:n}={}){const{origin:i,url:s,hash:r}=f.fromUrl(e);return i!==window.location.origin||!(!n||!this.triggerWillOpenNewWindow(n))||!!this.options.ignoreVisit(s+r,{el:n})}linkClickHandler(e){const n=e.delegateTarget,{href:i,url:s,hash:r}=f.fromElement(n);if(this.shouldIgnoreVisit(i,{el:n}))return;if(e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)return void this.triggerEvent("openPageInNewTab",e);if(e.button!==0)return;if(this.triggerEvent("clickLink",e),e.preventDefault(),!s||s===d())return void this.handleLinkToSamePage(s,r,e);if(this.isSameResolvedUrl(s,d()))return;this.scrollToElement=r||null;const a=n.getAttribute("data-swup-transition")||void 0;this.performPageLoad({url:s,customTransition:a})}handleLinkToSamePage(e,n,i){if(n){if(this.triggerEvent("samePageWithHash",i),!q(n))return console.warn(`Element for offset not found (#${n})`);R(e+n)}else this.triggerEvent("samePage",i)}triggerWillOpenNewWindow(e){return!!e.matches('[download], [target="_blank"]')}popStateHandler(e){var n,i;if(this.options.skipPopStateHandling(e)||this.isSameResolvedUrl(d(),this.currentPageUrl))return;const s=(n=(i=e.state)==null?void 0:i.url)!=null?n:location.href;if(this.shouldIgnoreVisit(s))return;const{url:r,hash:a}=f.fromUrl(s);a?this.scrollToElement=a:e.preventDefault(),this.triggerEvent("popState",e),this.options.animateHistoryBrowsing||(document.documentElement.classList.remove("is-animating"),O()),this.performPageLoad({url:r,event:e})}resolveUrl(e){if(typeof this.options.resolveUrl!="function")return console.warn("[swup] options.resolveUrl expects a callback function."),e;const n=this.options.resolveUrl(e);return n&&typeof n=="string"?n.startsWith("//")||n.startsWith("http")?(console.warn("[swup] options.resolveUrl needs to return a relative url"),e):n:(console.warn("[swup] options.resolveUrl needs to return a url"),e)}isSameResolvedUrl(e,n){return this.resolveUrl(e)===this.resolveUrl(n)}}export{f as Location,B as classify,O as cleanupAnimationClasses,K as createHistoryRecord,we as default,x as delegateEvent,J as escapeCssIdentifier,Q as fetch,d as getCurrentUrl,z as getDataFromHtml,Y as markSwupElements,G as nextTick,w as query,m as queryAll,M as toMs,R as updateHistoryRecord};
